# -*- coding: utf-8 -*-
"""sales_deploy.ipynb

Automatically generated by Colaboratory.

Original file is located at
    https://colab.research.google.com/drive/1ZcnVyhPRKuNbRbgxzzFO8mzCG7lV9vkd
"""

from flask import Flask, request, jsonify
import joblib
import numpy as np
import pandas as pd

app = Flask(__name__)

MODELS = {
    'RNN': joblib.load('model_RNN.pkl'),
    'LinReg': joblib.load('model_LinReg.pkl'),
    'RidgeReg': joblib.load('model_RidgeReg.pkl'),
    'RFReg': joblib.load('model_RFReg.pkl')
}

SCALER = joblib.load('min_max_scaler.pkl')

def scale_input(X):
    X_scaled = SCALER.transform(X)
    return X_scaled

def predict_using_selected_model(X, model_type):
    X_scaled = scale_input(X)
    pred = MODELS[model_type].predict(X_scaled)
    return pred

@app.route('/predict', methods=['POST'])
def predict():
    data = request.get_json()
    # Preprocess input data (scale it)
    X = pd.DataFrame(data)[pd.DataFrame(data).columns[:-1]]
    prediction = predict_using_selected_model(X, request.args.get('model'))
    return jsonify({'prediction': prediction})

if __name__ == '__main__':
    app.run(debug=True)

